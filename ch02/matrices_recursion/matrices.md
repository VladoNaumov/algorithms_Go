## Что такое Backtracking

**Backtracking — это рекурсивный поиск решения, который:**

* пробует один вариант,
* проверяет его,
* если он неправильный — откатывается назад и пробует другой.

## Когда применяется Backtracking

* задачи перестановок (все комбинации, все варианты)
* головоломки (судоку, лабиринты)
* размещение объектов (8 ферзей)
* подбор вариантов (пароли, комбинации)
* парсинг выражений
* поиск путей в графе
---

## Пример 1. Собрать кодовый замок

Допустим, код из 3 цифр.

Ты пробуешь:

* 1 0 0 → не подходит
* возвращаешься, меняешь последнюю цифру
* 1 0 1
* 1 0 2
* …
* Когда все варианты с началом 1 0 * перебраны → возвращаешься на шаг назад:

→ меняешь вторую цифру:

* 1 1 0
* 1 1 1
* …

Постоянные **пробы + откаты назад** → Backtracking.

---

## Пример 2. Составить слово из букв

У тебя есть буквы: A, B, C.

Как составить все слова длины 3?

Backtracking делает так:

1. Начинаем: A
2. Добавляем вторую букву: A B
3. Добавляем третью: A B C → записываем
4. Третью больше менять нельзя → откатываемся:

    * A B A
    * A B B
    * A B C
5. Когда все комбинации с A B * перебраны → откат и меняем вторую букву:

    * A C A
    * A C B
    * A C C
6. Потом откат полностью → начинаем с B…

---


### Matrics + Backtracking Search

```
| #  | Категория                  | Название Задачи                         | Описание Матрицы / Цель                                                                                     | Принцип Backtracking                                                                                                                               |
|----|----------------------------|---------------------------------------- |-------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------|
| 1  | Размещение                 | Проблема N-Ферзей (N-Queens)            | Матрица N×N. Найти все способы размещения N ферзей без конфликтов.                                          | Проверять безопасность хода в каждой строке. При неудаче возврат к предыдущему столбцу.                                                            |
| 2  | Распределение              | Решение Судоку (Sudoku Solver)          | Матрица 9×9. Заполнить пустые ячейки цифрами, соблюдая правила.                                             | Находить пустую ячейку. Пробовать цифры 1..9. Если ограничение нарушено, возврат и проба следующей цифры.                                          |
| 3  | Поиск Пути                 | Крепость в Лабиринте (Rat in a Maze)    | Бинарная матрица M×N (проходы/стены). Найти все пути от старта до финиша.                                   | Рекурсивно исследовать доступные направления. При тупике или стене возврат к предыдущей клетке.                                                    |
| 4  | Обход                      | Рыцарский Обход (Knight's Tour)         | Матрица N×N (шахматная доска). Посетить каждую клетку ровно один раз ходом рыцаря.                          | Пробовать 8 ходов рыцаря. Если ход ведет на посещённую клетку, возврат и проба другого хода.                                                       |
| 5  | Поиск Комбинаций           | Поиск Слова в Сетке (Word Search)       | Матрица M×N с буквами. Найти все слова, соединяя соседние клетки.                                           | Рекурсивно исследовать 8 соседних клеток. Если последовательность не формирует слово, возврат и проба другого направления.                         |
| 6  | Генерация Путей            | Все Простые Пути в Матрице              | Матрица M×N. Найти все пути от (0,0) до (M-1,N-1), двигаясь только вправо/вниз.                             | Рекурсивно пробовать два хода: вправо и вниз. Если ход за границу, возврат.                                                                        |
| 7  | Минимальный Путь           | Сбор Золота в Шахте (Max Weighted Path) | Взвешенная матрица M×N. Найти путь с максимальной суммой, двигаясь вправо, вправо-вверх или вправо-вниз.    | Рекурсивно перебирать 3 возможных хода. Использовать отсечение (прунинг), если текущая сумма становится слишком мала.                              |
| 8  | Сложный Путь               | Лабиринт с Ключами и Дверями            | Матрица M×N с объектами (ключи, двери). Найти путь, собирая нужные ключи для дверей.                        | Рекурсивно исследовать путь, отслеживая состояние инвентаря. При запертой двери без ключа возврат.                                                 |
| 9  | Генерация Форм             | Разбиение Полимино (Polyomino Tiling)   | Матрица M×N. Покрыть матрицу заданным набором полимино без наложений.                                       | Пробовать разместить следующую фигуру в первой свободной клетке. Если фигура не помещается, возврат и проба другой ориентации/фигуры.              |
| 10 | Раскраска                  | Раскраска Графа (по матрице смежности)  | Матрица N×N (соседство областей). Назначить цвета областям карты, чтобы соседи имели разные цвета.          | Рекурсивно назначать цвет следующей области. Если цвет конфликтует с соседом, возврат и проба следующего цвета.                                    |
| 11 | Поиск Элементов            | Расстановка Мин (Minesweeper Solver)    | Матрица N×N. Определить все возможные безопасные положения мин, исходя из числовых подсказок.               | Рекурсивно предполагать, является ли клетка миной или нет. Если предположение нарушает подсказки соседей, возврат.                                 |
| 12 | Генерация                  | Генерация Кроссворда (Simplified)       | Матрица M×N. Разместить слова из списка в сетке так, чтобы они пересекались и не нарушали правила.          | Пробовать разместить следующее слово в доступном месте. Если размещение блокирует другие слова, возврат.                                           |
| 13 | Бинарное Покрытие          | Проблема Домино (Domino Tiling)         | Матрица M×N. Покрыть всю матрицу плитками домино (1×2) без наложений.                                       | Найти первую свободную клетку. Пробовать разместить домино вертикально или горизонтально. Если размещение невозможно, возврат.                     |
| 14 | Перестановки               | Размещение Объектов с Ограничениями     | Матрица M×N. Разместить K объектов так, чтобы они не находились на одной линии.                             | Рекурсивно перебирать ячейки для размещения объекта. Если новое размещение нарушает ограничение, возврат.                                          |
| 15 | Разделение                 | Разбиение на Квадраты (Matrix Partition)| Матрица N×N. Найти все способы разрезать матрицу на заданное количество меньших непересекающихся квадратов. | Рекурсивно выбирать линию разреза (горизонтальную или вертикальную). Если разрезание не приводит к нужным квадратам, возврат и выбор другой линии. |
| 16 | Поиск Островов             | Подсчёт островов                        | Матрица M×N (0/1). Посчитать количество «островов» (соединённых единиц).                                    | Рекурсивно (DFS) отмечать и считать соединённые компоненты. При обнаружении острова возврат после полного обхода.                                  |
| 17 | Заливка                    | Заливка области (Flood Fill)            | Матрица M×N с цветами. Изменить цвет области, соединённой одинаковыми цветами, начиная с заданной клетки.   | Рекурсивно исследовать 4/8 соседей. Если цвет совпадает, изменить и продолжить; иначе возврат.                                                     |
| 18 | Проверка                   | Проверка симметрии                      | Квадратная матрица N×N. Проверить симметрию относительно главной диагонали.                                 | Рекурсивно сравнивать элементы симметрично. При несоответствии возврат false.                                                                      |
| 19 | Сумма Элементов            | Сумма всех элементов                    | Матрица M×N с числами. Найти сумму всех элементов рекурсивно.                                               | Рекурсивно суммировать по строкам/столбцам. Базовый случай: пустая матрица или конец строки.                                                       |
| 20 | Переворот                  | Переворот матрицы                       | Квадратная матрица N×N. Повернуть на 90° по часовой стрелке рекурсивно.                                     | Рекурсивно менять элементы в циклах (4 угла). Разделять на подматрицы.                                                                             |
| 21 | Поиск Максимума            | Поиск максимального элемента            | Матрица M×N с числами. Найти максимальное число рекурсивно.                                                 | Рекурсивно сравнивать элементы по строкам/столбцам. Базовый случай: один элемент.                                                                  |
| 22 | Генерация Комбинаций       | Генерация всех комбинаций клеток        | Матрица M×N. Сгенерировать все возможные последовательности клеток длины k.                                 | Рекурсивно выбирать/пропускать клетки. При достижении длины k добавлять в результат; иначе возврат.                                                |
| 23 | Минимальный Путь           | Путь с минимальной стоимостью           | Взвешенная матрица M×N. Найти путь с минимальной суммой весов от старта до финиша.                          | Рекурсивно перебирать возможные ходы с мемоизацией. При превышении минимума прунинг и возврат.                                                     |
| 24 | Обход Змейкой              | Змейка (Snake pattern)                  | Матрица M×N. Обойти матрицу «змейкой» (по спирали) и собрать элементы в список рекурсивно.                  | Рекурсивно удалять границы матрицы (верх, право, низ, лево). Базовый случай: пустая матрица.                                                       |
| 25 | Подсчёт Квадратов          | Подсчёт квадратов единиц                | Бинарная матрица M×N. Посчитать все квадраты размера k x k, заполненные единицами.                          | Рекурсивно проверять подматрицы на заполненность. При несоответствии возврат.                                                                      |
| 26 | Поиск Фигур                | Подсчёт всех L-образных фигур           | Матрица M×N (0/1). Найти все L-образные фигуры (3 клетки).                                                  | Рекурсивно перебирать позиции и ориентации. Если фигура не подходит, возврат.                                                                      |
| 27 | Конвертация                | Рекурсивная конвертация матрицы в список| Матрица M×N. Преобразовать в одномерный список рекурсивно.                                                  | Рекурсивно добавлять элементы по строкам/столбцам. Базовый случай: конец строки/матрицы.                                                           |
| 28 | Подсчёт Периметра          | Подсчёт периметра островов              | Матрица M×N (0/1). Для каждой группы единиц (острова) посчитать периметр рекурсивно.                        | Рекурсивно (DFS) считать границы острова (смежные с 0 или краем). При посещении клетки возврат после подсчёта соседей.                             |

```



